title autonomous DSO change

participant CPMS_PowerManagerService
participant DSOs_API
participant batteryPack_API

activate CPMS_PowerManagerService
CPMS_PowerManagerService->>DSOs_API:periodicCostCheck
activate DSOs_API
DSOs_API-->CPMS_PowerManagerService:prices
deactivate DSOs_API
alt new prices better than old ones 
	CPMS_PowerManagerService->CPMS_PowerManagerService:selectBetterOne
	CPMS_PowerManagerService->DSOs_API:stipulateNewContract
    activate DSOs_API
	DSOs_API-->CPMS_PowerManagerService:done
    deactivate DSOs_API
end

CPMS_PowerManagerService->batteryPack_API:getBatteryLevel
activate batteryPack_API
batteryPack_API-->CPMS_PowerManagerService:batteryLevel
alt Not full
	CPMS_PowerManagerService->batteryPack_API:getStoredEnergyPrice
	batteryPack_API-->CPMS_PowerManagerService:storedEnergyPrice
    deactivate batteryPack_API
    
    alt Current price lower than stored one or is night time
        CPMS_PowerManagerService->batteryPack_API:fillBatteries
        activate batteryPack_API 
        #batteryPack_API-->CPMS_PowerManagerService:processStart
        space
        space
        batteryPack_API-->CPMS_PowerManagerService:processEnd
        deactivate batteryPack_API
    end    
end