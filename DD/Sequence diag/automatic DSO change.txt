title autonomous DSO  changing

participant DSOManagingService
participant DSOs_API
participant batteryPack_API

activate DSOManagingService
DSOManagingService->>DSOs_API:periodicCostCheck
activate DSOs_API
DSOs_API-->DSOManagingService:prices
deactivate DSOs_API
alt new prices better than old one 
	DSOManagingService->DSOManagingService:selectBetterOne
	DSOManagingService->DSOs_API:stipulateNewContract
    activate DSOs_API
	DSOs_API-->DSOManagingService:done
    deactivate DSOs_API
end

	DSOManagingService->batteryPack_API:getBatteryLevel
	activate batteryPack_API
	batteryPack_API-->DSOManagingService:batteryLevel
	alt not full
		DSOManagingService->batteryPack_API:getStoredEnergyPrice
		batteryPack_API-->DSOManagingService:storedEnergyPrice
        deactivate batteryPack_API
        alt current price lower than stored one or is night time
        	DSOManagingService->batteryPack_API:fullBatteries
            activate batteryPack_API 
            batteryPack_API-->DSOManagingService:processStart
            batteryPack_API-->DSOManagingService:processEnd
            deactivate batteryPack_API
        end
        
    end