title Charging process

actor Registered User
participant eMSP
participant eMSP
participant CPMS



activate eMSP

Registered User->eMSP:Select reservation
Registered User<--eMSP: Instructions 

alt NFC enabled
Registered User->eMSP:NFC tag readout
else NFC disabled
Registered User->eMSP:Insert column token
end



eMSP->CPMS:requestUnlock(resID,colTok)
activate CPMS
eMSP<--CPMS:confirm reservation

CPMS->CPMS:unlockSocket()

parallel on
CPMS-->eMSP: Confirmation

eMSP-->Registered User: Confirmation
parallel off
space

deactivate eMSP


Registered User->Registered User:Plug Car

Registered User->Registered User:Waiting


parallel  on
CPMS->eMSP:DoneCharging

eMSP->Registered User: Notify user of\ncomplete charge
parallel off

activate eMSP


Registered User->Registered User:Unplug Car

CPMS->CPMS:lockSocket()

parallel  on
CPMS->eMSP:ChargingBill(data)
parallel off

eMSP->eMSP:ProcessPayment
activate eMSP
space
deactivate eMSP


eMSP->Registered User: Show final bill
deactivate eMSP

CPMS->CPMS:freeRemaining\nTimeframe()
deactivate CPMS



